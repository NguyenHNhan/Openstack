
apt install mariadb-server
systemctl enable mariadb
systemctl start mariadb
NEWPASSDB="123"
echo -e "$NEWPASSDB\n$NEWPASSDB\ny\ny\ny\ny\n" | sudo mysql_secure_installation

apt -y install rabbitmq-server memcached python3-pymysql 
////
rabbitmqctl add_user openstack 123
#rabbitmqctl change_password openstack 123

rabbitmqctl set_permissions openstack ".*" ".*" ".*" 

wget -O /etc/mysql/mariadb.conf.d/50-server.cnf https://github.com/NguyenHNhan/Openstack/raw/88ea2ec83e4d9def5f7f0226e9210c1cb865f18f/conf/50-server.cnf

wget -O /etc/memcached.conf https://raw.githubusercontent.com/NguyenHNhan/Openstack/b087e53e23e438df45b3562240b2143e2cb3039a/conf/memcached.conf

sudo unlink /etc/nginx/sites-enabled/default

sudo systemctl restart mariadb rabbitmq-server memcached nginx 

sudo apt -y install keystone python3-openstackclient apache2 libapache2-mod-wsgi-py3 python3-oauth2client 



PASSDB="123"
SQL_COMMANDS="
DROP DATABASE IF EXISTS keystone;
CREATE DATABASE keystone;
GRANT ALL PRIVILEGES ON keystone.* TO stackdb@'localhost' IDENTIFIED BY '$PASSDB';
GRANT ALL PRIVILEGES ON keystone.* TO stackdb@'%' IDENTIFIED BY '$PASSDB';
FLUSH PRIVILEGES;
"
mysql <<< "$SQL_COMMANDS"
//cau hinh keystone
sudo wget -O /etc/keystone/keystone.conf https://github.com/NguyenHNhan/Openstack/raw/e235a9344ea8f45433fffb42bdd091b6515d4e58/conf/keystone.conf

sudo su -s /bin/bash keystone -c "keystone-manage db_sync" 
sudo keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone 
sudo keystone-manage credential_setup --keystone-user keystone --keystone-group keystone 
sudo keystone-manage bootstrap --bootstrap-password adminpassword \
--bootstrap-admin-url https://controller:5000/v3/ \
--bootstrap-internal-url https://controller:5000/v3/ \
--bootstrap-public-url https://controller:5000/v3/ \
--bootstrap-region-id RegionOne

sudo wget -O /etc/apache2/apache2.conf https://github.com/NguyenHNhan/Openstack/raw/0b1e7e6bdfa320260b2320f15ccc2522928f6cce/conf/apache2.conf


sudo wget -O /etc/apache2/sites-available/keystone.conf https://github.com/NguyenHNhan/Openstack/raw/f0bb73bef22a8262d48ed629f85dad5411e6dd5c/conf/sites-available/keystone.conf

sudo a2enmod ssl 


export OS_PROJECT_DOMAIN_NAME=default
export OS_USER_DOMAIN_NAME=default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=adminpassword
export OS_AUTH_URL=https://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2


